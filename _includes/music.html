<!-- APlayer -->
<link rel="stylesheet" href="https://unpkg.com/aplayer/dist/APlayer.min.css">
<script src="https://unpkg.com/aplayer/dist/APlayer.min.js"></script>

<style>
  #music-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 42px;
    height: 42px;
    background: rgba(255,255,255,0.8);
    border-radius: 50%;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 9999;
    font-size: 20px;
  }
  #music-btn:hover {
    background: rgba(255,255,255,1);
  }
  #player-bar {
    position: fixed;
    bottom: -100px;
    left: 0;
    width: 100%;
    transition: 0.35s ease;
    z-index: 9998;
  }
  #player-bar.show {
    bottom: 0;
  }
</style>

<!-- æ‚¬æµ®æŒ‰é’® + æ’­æ”¾å™¨å®¹å™¨ -->
<div id="music-btn">ğŸµ</div>
<div id="player-bar"></div>

<script>
  /* è¯»å–æ‰‹åŠ¨ç»´æŠ¤çš„ music-data.json å¹¶åˆå§‹åŒ– APlayer */
  fetch("{{ '/assets/music/music-data.json' | relative_url }}")
    .then(res => res.json())
    .then(data => {
      const musicList = data.map(item => {
        // é»˜è®¤æ­Œå/æ­Œæ‰‹
        const name = item.name && item.name.trim() ? item.name : "æœªçŸ¥";
        const artist = item.artist && item.artist.trim() ? item.artist : "æœªçŸ¥";

        // é»˜è®¤å°é¢
        let coverFile = item.cover && item.cover.trim() ? item.cover : "cover.jpg";
        // æ‹¼æ¥å®Œæ•´è·¯å¾„
        let cover = "{{ '/assets/music/cover/' | relative_url }}" + coverFile;

        // åˆ›å»º Image å¯¹è±¡æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        let img = new Image();
        img.src = cover;
        img.onerror = function() {
          // æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä½¿ç”¨é»˜è®¤å°é¢
          cover = "{{ '/assets/music/cover/cover.jpg' | relative_url }}";
        };
        return {
          name: name,
          artist: artist,
          url: "{{ '/assets/music/' | relative_url }}" + item.file,
          cover: cover
        };
      });

      // åˆå§‹åŒ– APlayer
      const ap = new APlayer({
        container: document.getElementById('player-bar'),
        fixed: true,
        audio: musicList,
        listFolded: false,
        order: 'list',
        autoplay: false,
        preload: 'auto'
      });
    });

  // æ‚¬æµ®æŒ‰é’®å±•å¼€/æ”¶èµ·æ’­æ”¾å™¨
  const btn = document.getElementById('music-btn');
  const bar = document.getElementById('player-bar');
  btn.onclick = function () {
    bar.classList.toggle('show');
  };
</script>
